{% extends 'base.html' %}

{% block title %}Add Registration{% endblock %}

{% block content %}
<div class="page-header">
    <h1>â• Add New Registration</h1>
</div>

<div class="card" style="max-width: 700px; margin: 0 auto;">
    <p style="color: #6b7280; margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
        <strong>ğŸ’¡ Protected by Triggers & Stored Procedure:</strong> This registration uses <code>sp_register_user_for_event</code> 
        stored procedure with capacity validation. The trigger <code>trg_before_registration_insert</code> ensures event 
        capacity is not exceeded, and <code>trg_after_registration_insert</code> automatically creates an attendance record.
    </p>
    
    <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
            <label>Event *</label>
            <select name="event" required>
                <option value="">Select Event</option>
                {% for event in events %}
                <option value="{{ event.event_id }}">{{ event.title }} (Capacity: {{ event.capacity }})</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label>Participant *</label>
            <select name="user" required>
                <option value="">Select User</option>
                {% for user in users %}
                <option value="{{ user.user_id }}">{{ user.name }} ({{ user.roll_no|default:"No Roll" }})</option>
                {% endfor %}
            </select>
        </div>
        
        <div style="display: flex; gap: 10px;">
            <button type="submit" class="btn btn-primary">ğŸ’¾ Register User</button>
            <a href="{% url 'registration_list' %}" class="btn" style="background: #e5e7eb; color: #374151;">âŒ Cancel</a>
        </div>
    </form>
</div>
{% endblock %}